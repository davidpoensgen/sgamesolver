%TODO tensor notation for Herings et al. interior-point method
%TODO double check everything (typos, indices, etc.)


\documentclass[11pt,fleqn]{article}
\usepackage[a4paper,left=2cm,right=2.5cm,top=2cm,bottom=3cm]{geometry}
\usepackage{setspace}
	\onehalfspacing
    \setlength\parindent{0pt}
    \setlength\parskip{12pt}

\usepackage[american]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{pdflscape}
\usepackage{verbatim}

\usepackage{booktabs} % nice tabulars
\usepackage{multirow} % \multirow{number of rows}{c}{text}

\usepackage[round,authoryear]{natbib}
	\bibliographystyle{ecta}
\usepackage{hyperref}
    \hypersetup{colorlinks=true, linkcolor=blue, citecolor=blue, urlcolor=blue}

% fix boldsymbol index spacing
% https://tex.stackexchange.com/questions/234951/boldsymbol-badly-modifies-spacing
\usepackage{bm} 

\usepackage{amsmath}
	\newcommand{\e}{\text{e}}
	\newcommand{\rank}{\text{rank}}
	\newcommand*{\rline}{\multicolumn{1}{c|}{}}
\usepackage{mathtools}
\usepackage{amsfonts}
    \newcommand{\G}{\mathcal{G}}
    \newcommand{\R}{\mathbb{R}}
    \newcommand{\bsigma}{\bm{\sigma}}
    \newcommand{\bbeta}{\bm{\beta}}
    \newcommand{\brho}{\bm{\rho}}
    \newcommand{\bV}{\bm{V}}
    \newcommand{\bnu}{\bm{\nu}}
    \newcommand{\bzero}{\bm{0}}
    \newcommand{\bone}{\bm{1}}
    \newcommand{\ba}{\bm{a}}
    \newcommand{\tu}{\tilde{u}}
    \newcommand{\by}{\bm{y}}
    \newcommand{\bz}{\bm{z}}
\usepackage{amsthm}
    \newtheorem{definition}{Definition}
    \newtheorem{lemma}{Lemma}
    \newtheorem{proposition}{Proposition}
    \newtheorem{theorem}{Theorem}
    \newtheorem{corollary}{Corollary}
\usepackage{amssymb}
    \renewcommand{\qed}{$\hfill\blacksquare$}
\usepackage{dsfont}
	\newcommand{\id}{\mathds{1}}
\usepackage{accents} 
    \newcommand{\ubar}[1]{\underaccent{\bar}{#1}}

\usepackage{tikz}
\usepackage{color}

% short -i
% https://tex.stackexchange.com/questions/6058/making-a-shorter-minus
% https://tex.stackexchange.com/questions/412065/scalebox-distorts-output-of-fraction-and-subscripts
\newcommand{\shortminus}{{\text{\scalebox{0.4}[1.0]{\(-\)}}}}
\newcommand{\minusi}{\shortminus i}
\newcommand{\mediumminus}{{\text{\scalebox{0.8}[1.0]{\(-\)}}}}

% short arrow for state transitions
% https://tex.stackexchange.com/questions/269935/arrows-of-arbitrary-length
\newcommand{\shortrightarrow}{\parbox{4pt}{\tikz{\draw[->](0,0)--(4pt,0);}}}

\newcommand{\phiss}{\phi_{s\shortrightarrow s'}}
\newcommand{\barphiss}{\bar{\phi}_{s\shortrightarrow s'}}






\begin{document}


\date{\today}
\title{\vspace{-2em}\Large
\textit{dsGameSolver}: \\ Homotopy Functions and Jacobian Matrices}
\author{
Steffen EibelshÃ¤user\footnote{Goethe University Frankfurt, \href{mailto:eibelshaeuser@econ.uni-frankfurt.de}{\nolinkurl{eibelshaeuser@econ.uni-frankfurt.de}}} %
\and %
David Poensgen\footnote{Goethe University Frankfurt, \href{mailto:poensgen@econ.uni-frankfurt.de}{\nolinkurl{poensgen@econ.uni-frankfurt.de}}}
}

\maketitle
\thispagestyle{empty}


\begin{spacing}{0.75}
\setcounter{secnumdepth}{2}
\tableofcontents
\thispagestyle{empty}
\end{spacing}
\null\vspace{2em}
\pagebreak




\section{Notation}

States, players and actions are denoted by $s\in S$, $i\in I$ and $a\in A_{si}$, respectively. 

Strategies are denoted by $\sigma_{sia}$, representing the probability of player $i$ in state $s$ playing action $a$. 

Expected payoffs for player $i$ in state $s$ under strategy profile $\bsigma_{s}$ are denoted by $u_{si}(\bsigma_{s})$. 

State transition probabilities under strategy profile $\bsigma_{s}$ are denoted by $\phiss(\bsigma_{s})$. 

Individual discount factors for all players are denoted by $\delta_i$.

Continuation values for player $i$ in state $s$ are denoted by $V_{si}$. 

Expected discounted payoffs $\tu_{si}(\bsigma_{s},\bV_i)$ for player $i$ in state $s$
under strategy profile $\bsigma_{s}$ and for given continuation values $\bV_i$, are given by
\begin{align*}
	\tu_{si}(\bsigma_{s},\bV_i) & \;=\; u_{si}(\bsigma_{s}) \,+\, \delta_i \sum\limits_{\mathclap{s'\in S}} \phiss(\bsigma_{s}) \; V_{s'i}
\end{align*}
Fixing action $a$ for player $i$ in state $s$, one can use $\tu_{sia}(\bsigma_{s,\minusi},\bV_i) = \tu_{si}\bigl((a,\bsigma_{s,\minusi}),\bV_i\bigr)$.




\section{Stochastic Quantal Response Equilibrium}


\subsection*{Homotopy Function}

The homotopy function is based on \citet[eqn.~X, p.~Y]{EibelshaeuserPoensgen2021QRE}. 
\begin{align*}
	\sigma_{sia} & \;=\; \frac{ \exp\bigl(\lambda\tu_{sia}(\bsigma_{s,\minusi},\bV_i)\bigr) }{ \sum\limits_{\mathclap{a'\in A_{si}}} \exp\bigl(\lambda\tu_{sia'}(\bsigma_{s,\minusi},\bV_i)\bigr) } && s\in S, i\in I, a\in A_{si} \\
	V_{si} & \;=\; \sum\limits_{\mathclap{a\in A_{si}}} \sigma_{sia} \; \tilde{u}_{sia}(\bsigma_{s,\minusi},\bV_i) && s\in S, i\in I
\end{align*}
where $\lambda \geq 0$ denotes the precision parameter of the quantal response equilibrium.

There are two types of equations: strategy equations and value equations. The strategy equations involve the exponential of the homotopy parameter $\lambda$. Since $\lambda$ is taken towards infinity, the corresponding exponentials might become very large, potentially leading to numerical overflow. In order to ensure numerical stability, two transformations on the strategy equations are performed, following \cite{Turocy2005, Turocy2010}. First, a reference action is introduced and, second, the natural logarithm is applied. 

For each state-player tuple $(s,i)$, the strategy equations are divided by the equation of reference action $a=0$.
\begin{align*}
	\frac{ \sigma_{si,a>0} }{ \sigma_{si0} } \;=\; \exp\biggl( \lambda [\tu_{sia}(\bsigma_{s,\minusi},\bV_i) - \tu_{si0}(\bsigma_{s,\minusi},\bV_i)] \biggr)
\end{align*}
Then, the natural logarithm is applied.
\begin{align*}
	\log(\sigma_{si,a>0}) - \log(\sigma_{si0}) \;=\; \lambda \bigl[ \tu_{sia}(\bsigma_{s,\minusi},\bV_i) - \tu_{si0}(\bsigma_{s,\minusi},\bV_i) \bigr]
\end{align*}
Finally, the substitution $\beta_{sia} := \log(\sigma_{si})$ is applied and the components of the homotopy function are defined as follows.
\begin{align*}
	H_{si0}^{\sigma}(\bbeta,\bV,\lambda) & \;=\; 1 - \sum\limits_{\mathclap{a\in A_{s,i}}} \exp(\beta_{sia}) && s\in S, i\in I \\
	H_{sia}^{\sigma}(\bbeta,\bV,\lambda) & \;=\; - \bigl[ \beta_{sia} - \beta_{si0} \bigr] \;+\; \lambda \bigl[ \tu_{sia}(\bbeta_{s,\minusi},\bV_i) - \tu_{si0}(\bbeta_{s,\minusi},\bV_i) \bigr] && s\in S, i\in I, 0<a\in A_{si} \\
	H_{si}^{V}(\bbeta,\bV,\lambda) & \;=\; - V_{si} \;+\; \sum\limits_{\mathclap{a\in A_{si}}} \exp(\sigma_{sia}) \; \tu_{sia}(\bbeta_{s,\minusi},\bV_{i}) && s\in S, i\in I
\end{align*}
Due to the normalization by reference action $a=0$, the corresponding strategy equations are replaced by equations ensuring that action probabilities sum up to one. 

Defining dimension $n := |A|+|S\times I|$, the full homotopy function $H: \R^{n+1} \rightarrow \R^n$, is obtained by stacking all components.
\begin{align*}
	H(\bbeta,\bV,\lambda) \;=\;
	\begin{pmatrix} 
		H^{\sigma}(\bbeta,\bV,\lambda) \\ 
		H^{V}(\bbeta,\bV,\lambda) 
	\end{pmatrix}
\end{align*}


\subsection*{Jacobian Matrix}

$J: \R^{n+1} \rightarrow \R^n \times \R^{n+1}$:
\begin{align*}
	J(\bbeta,\bV,\lambda) \;=\; 
	\begin{pmatrix}
		\frac{ \partial H_{sia}^{\sigma}(\bbeta,\bV,\lambda) }{ \partial \beta_{s'i'a'} } & 
		\frac{ \partial H_{sia}^{\sigma}(\bbeta,\bV,\lambda) }{ \partial V_{s'i'} } & 
		\frac{ \partial H_{sia}^{\sigma}(\bbeta,\bV,\lambda) }{ \partial \lambda } \\
		\frac{ \partial H_{si}^{V}(\bbeta,\bV,\lambda) }{ \partial \beta_{s'i'a'} } & 
		\frac{ \partial H_{si}^{V}(\bbeta,\bV,\lambda) }{ \partial V_{s'i'} } & 
		\frac{ \partial H_{si}^{V}(\bbeta,\bV,\lambda) }{ \partial \lambda }
	\end{pmatrix}
\end{align*}
with
\begin{align*}
	\frac{ \partial H_{si0}^{\sigma}(\bbeta,\bV,\lambda) }{ \partial \beta_{s'i'a'} } \;=\; 
	\begin{cases}
		-\exp(\beta_{sia'}) & \text{ if } s'=s, i'=i \\
		0 & \text{ else}
	\end{cases} 
\end{align*}
\begin{align*}
	\frac{ \partial H_{si0}^{\sigma}(\bbeta,\bV,\lambda) }{ \partial V_{s'i'} } \;=\; 0
\end{align*}
\begin{align*}
	\frac{ \partial H_{si0}^{\sigma}(\bbeta,\bV,\lambda) }{ \partial \lambda } \;=\; 0
\end{align*}

\begin{align*}
	\frac{ \partial H_{si,a>0}^{\sigma}(\bbeta,\bV,\lambda) }{ \partial \beta_{s'i'a'} } \;=\; 
		\begin{cases} 
			1 & \text{ if } s'=s, i'=i, a'=0 \\
			-1 & \text{ if } s'=s, i'=i, a'>0 \\
			\lambda \left[ \frac{ \partial \tu_{sia}(\bbeta_{s,\minusi},\bV_i) }{ \partial \beta_{s'i'a'} } - \frac{ \partial \tu_{si0}(\bbeta_{s,\minusi},\bV_i) }{ \partial \beta_{s'i'a'} } \right] & \text{ if } s'=s, i' \neq i \\
			0 & \text{ else}
		\end{cases}
\end{align*}
\begin{align*}
	\frac{ \partial H_{si,a>0}^{\sigma}(\bbeta,\bV,\lambda) }{ \partial V_{s'i'} } \;=\; \lambda \left[ \frac{ \partial \tu_{sia}(\bbeta_{s,\minusi},\bV_i) }{ \partial V_{s'i'} } - \frac{ \partial \tu_{si0}(\bbeta_{s,\minusi},\bV_i) }{ \partial V_{s'i'} } \right] 
\end{align*}
\begin{align*}
	\frac{ \partial H_{si,a>0}^{\sigma}(\bbeta,\bV,\lambda) }{ \partial \lambda } \;=\; \tu_{sia}(\bbeta_{s,\minusi}) - \tu_{si0}(\bbeta_{s,\minusi})
\end{align*}

\begin{align*}
	\frac{ \partial H_{si}^{V}(\bbeta,\bV,\lambda) }{ \partial \beta_{s'i'a'} } \;=\; 
		\begin{cases}
			\exp(\beta_{sia'}) \; \tu_{sia'}(\bbeta_{s,\minusi},\bV_i) & \text{ if } s'=s, i'=i \\
			\sum\limits_{a''\in A_{si}} \exp(\beta_{sia''}) \; \frac{ \partial \tu_{sia''}(\bbeta_{s,\minusi},\bV_i) }{ \partial \beta_{si'a'} } & \text{ if } s'=s, i' \neq i \\
			0 & \text{ else}
		\end{cases}
\end{align*}
\begin{align*}
	\frac{ \partial H_{si}^{V}(\bbeta,\bV,\lambda) }{ \partial V_{si} } \;=\; 
		\begin{cases}
			- 1 + \sum\limits_{\mathclap{a''\in A_{si}}} \exp(\beta_{sia''}) \; \frac{ \partial \tu_{sia''}(\bbeta_{s,\minusi},\bV_i) }{ \partial V_{si} } & \text{ if } s'=s, i'=i \\
			\sum\limits_{a''\in A_{si}} \exp(\beta_{sia''}) \; \frac{ \partial \tu_{sia''}(\bbeta_{s,\minusi},\bV_i) }{ \partial V_{s'i} } & \text{ if } s' \neq s, i'=i \\
			0 & \text{ else}
		\end{cases}
\end{align*}
\begin{align*}
	\frac{ \partial H_{si}^{V}(\bbeta,\bV,\lambda) }{ \partial \lambda } \;=\; 0
\end{align*}
where
\begin{align*}
	\frac{ \partial \tu_{sia}(\bbeta_{s,\minusi},\bV_i) }{ \partial \beta_{s'i'a'} } \;=\; 
		\begin{cases}
			\sum\limits_{\substack{\ba_{s,\minusi} \in A_{s,\minusi} \\ a_{si'}=a'}} \prod\limits_{\substack{i''\in I \\ i''\neq i}} \exp\bigl(\beta_{si''a_{si''}}\bigr) \; \tu_{sia}(\ba_{s,\minusi},\bV_i) & \text{ if } s'=s, i' \neq i \\
			0 & \text{ else}
		\end{cases}
\end{align*}
\begin{align*}
	\frac{ \partial \tu_{sia}(\bbeta_{s,\minusi},\bV_i) }{ \partial V_{s'i'} } \;=\; 
		\begin{cases}
			\sum\limits_{\ba_{s,\minusi} \in A_{s,\minusi}} \prod\limits_{\substack{i''\in I \\ i''\neq i}} \exp\bigl(\beta_{si''a_{si''}}\bigr) \; \delta_i \phiss(a, \ba_{s,\minusi}) & \text{ for } i'=i \\
			0 & \text{ else}
		\end{cases}
\end{align*}




\subsection*{Tensor Notation}

Tensor notation is useful for three reasons. First, it allows for a more compact representation, Secondly, it facilitates the derivation of the Jacobian and, finally, it allows for efficient computation using the tensor functionality of Python's \textit{NumPy} package.

A tensor is in essence a multi-dimensional array, i.e.\ a generalization of vectors and matrices to higher dimensions. We use big round brackets to denote tensors and indices to denote the dimensions. For example
\begin{align*}
	\biggl( \bm{T} \biggr)_{ij}
\end{align*}
denotes a two-dimensional tensor with two dimensions named $i$ and $j$, corresponding to a matrix with entries $t_{ij}$.

A general tensor product can be written in Einstein notation, basically performing two operations at once: a multiplication and a summation. First, the indices appearing with the big round brackets provide the names of the tensors' dimensions. Multiplication is performed along all dimensions with the same name. Secondly, the big square brackets provide a list of indices to retain. Indices \emph{not} appearing with the square bracket indicate summation over these dimensions. For example
\begin{align*}
	\Biggl[ \biggl( \bm{T_1} \biggr)_{ij} \cdot \biggl( \bm{T_2} \biggr)_{jk} \Biggr]_{ik}
\end{align*}
is tensor notation for the usual matrix product.


\subsubsection*{Primitives}

In tensor notation, the primitives of the homotopy function read
\begin{align*}
	\biggl( \bbeta \biggr)_{sia} &\;:=\; \biggl( \bbeta_{si}(a) \biggr)_{s\in S, i\in I, a\in A_{si}} \\
	\biggl( \bsigma \biggr)_{sia} &\;:=\; \biggl( \exp(\bbeta_{si}(a)) \biggr)_{s\in S, i\in I, a\in A_{si}} \\
	\biggl( \bm{u} \biggr)_{si\ba} &:= \biggl( u_{si}(\ba) \biggr)_{s\in S, i\in I, \ba\in A} \\
	\biggl( \bV \biggr)_{si} &:= \biggl( V_{si} \biggr)_{s\in S, i\in I}
\end{align*}
where tensor index $\ba = (a_{si})_{i\in I}$ is a multi-index for entire strategy profiles.

Furthermore, in order to simplify the notation, we multiply the discount factors into the transition probabilities.
\begin{align*}
	\biggl( \bm{\phi} \biggr)_{si\ba s'} &\;:=\; \biggl( \delta_i \phiss(\ba) \biggr)_{s\in S, i\in I, \ba\in A, s'\in S}
\end{align*}
Finally, using Einstein notation, discounted payoffs and expected discounted payoffs can be written in the following compact form.
\begin{align*}
	\biggl( \bm{{\tu}} \biggr)_{si\ba} &\;:=\; \biggl( \bm{u} \biggr)_{si\ba} + \Biggl[ \biggl( \bm{\phi} \biggr)_{si\ba s'} \biggl( \bV \biggr)_{s'i} \Biggr]_{si\ba} \\
	\biggl( \bm{{E\tu^a}} \biggr)_{sia} &\;:=\; \left[ \quad \biggl( \bm{{\tu}} \biggr)_{si\ba} \prod\limits_{i'\neq i} \biggl( \bsigma \biggr)_{si'a_{i'}} \quad \right]_{sia} \\
	\biggl( \bm{{E\tu}} \biggr)_{si} &\;:=\; \left[ \quad \biggl( \bm{{\tu}} \biggr)_{si\ba} \prod\limits_{i'} \biggl( \bsigma \biggr)_{si'a_{i'}} \quad \right]_{si}
\end{align*}


\subsubsection*{Homotopy Function}

Based on the previous definitions and notation, the homotopy function can now be written in terms of tensor products
\begin{align*}
	\biggl( \bm{H^{\sigma}} \biggr)_{sia} &\;=\; 
		\biggl( \bm{T_0^H} \biggr)_{sia} \quad+\quad 
		\Biggl[ \biggl( \bm{T_1^H}\biggr)_{sias'i'a'} \biggl( \bsigma \biggr)_{s'i'a'} \Biggr]_{sia} \\
		&\quad+\quad \Biggl[ \biggl( \bm{T_2^H}\biggr)_{sias'i'a'} \biggl( \bbeta \biggr)_{s'i'a'} \Biggr]_{sia} \\
		&\quad+\quad \lambda \Biggl[ - \biggl( \bm{T_2^H}\biggr)_{sias'i'a'} \biggl( \bm{{E\tilde{u}^a}} \biggr)_{s'i'a'} \Biggr]_{sia}
\end{align*}
\begin{align*}
	\biggl( \bm{H^{V}} \biggr)_{si} &\;=\; 
		\Biggl[ \biggl( \bm{T_3^H}\biggr)_{sis'i'} \biggl( \bV \biggr)_{s'i'} \Biggr]_{si} \quad+\quad \Biggl[ - \biggl( \bm{T_3^H}\biggr)_{sis'i'} \biggl( \bm{{E\tu}} \biggr)_{s'i'} \Biggr]_{si} 
\end{align*}
with tensors $\boldsymbol{T_0^H}, \boldsymbol{T_1^H}, \boldsymbol{T_2^H}, \boldsymbol{T_3^H}$ defined as
\begin{align*}
	\biggl( \bm{T_0^H} \biggr)_{sia} \quad\;\;\: &= \biggl( \id_{\{a=0\}} \biggr)_{sia} \\
	\biggl( \bm{T_1^H} \biggr)_{sias'i'a'} &= \biggl( -\id_{\{s=s',i=i',a=0\}} \biggr)_{sias'i'a'} \\
	\biggl( \bm{T_2^H} \biggr)_{sias'i'a'} &= \biggl( -\id_{\{s=s',i=i',a=a'>0\}} + \id_{\{s=s',i=i',a>0,a'=0\}} \biggr)_{sias'i'a'} \\
	\biggl( \bm{T_3^H} \biggr)_{sias'i'a'} &= \biggl( -\id_{\{s=s',i=i'\}} \biggr)_{sis'i'}
\end{align*}
where $\id_{\{\text{condition}\}}$ denotes the indicator function which evaluates to one if the condition is satisfied and zero otherwise.


\subsubsection*{Jacobian Matrix}


\begin{align*}
	\frac{ \partial \biggl( \bm{H^{\sigma}} \biggr)_{sia} }{ \partial \biggl( \bbeta \biggr)_{s'i'a'} } \;=\; &
		\biggl( \bm{T_0^J} \biggr)_{sias'i'a'} \quad+\quad \Biggl[ \biggl( \bm{T_1^J}\biggr)_{sias'i'a'} \biggl( \bsigma \biggr)_{s'i'a'} \Biggr]_{sias'i'a'} \\
		& \;+\; \lambda \; \Biggl[ - \biggl( \bm{T_2^H}\biggr)_{sias''i''a''} \underbrace{ \frac{ \partial \biggl( \bm{{E\tu^a}} \biggr)_{s''i''a''} }{ \partial \biggl( \bbeta \biggr)_{s'i'a'} } }_{ 
			\mathclap{ = \biggl[ \bigl( \tilde{\bm{u}} \bigr)_{s''i''\ba''} \bigl( \bm{T_2^J} \bigr)_{s''i''\ba_{\minusi''}''s'i'a'} \prod\limits_{i'''\neq i''} \bigl( \bsigma \bigr)_{s''i'''a_{i'''}''} \biggr]_{s''i''a''s'i'a'} } } \Biggr]_{sias'i'a'} 
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{\sigma}} \biggr)_{sia} }{ \partial \biggl( \bV \biggr)_{s'i'} } \;=\; &
		\lambda \; \Biggl[ - \biggl( \bm{T_2^H}\biggr)_{sias''i''a''} \underbrace{ \frac{ \partial \biggl( \bm{{E\tu^a}} \biggr)_{s''i''a''} }{ \partial \biggl( \bV \biggr)_{s'i'} } }_{ 
			\mathclap{ = \biggl[ \bigl( \bm{T_3^J} \bigr)_{s''i''\ba''s'i'} \prod\limits_{i'''\neq i''} \bigl( \bsigma \bigr)_{s''i'''a_{i'''}''} \biggr]_{s''i''a''s'i'} } } \Biggr]_{sias'i'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{\sigma}} \biggr)_{sia} }{ \partial \lambda } \;=\; &
		\Biggl[ - \biggl( \bm{T_2^H}\biggr)_{sias''i''a''} \biggl( \bm{{E\tu^a}} \biggr)_{s''i''a''} \Biggr]
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{V}} \biggr)_{si} }{ \partial \biggl( \bbeta \biggr)_{s'i'a'} } \;=\; &
		\Biggl[ - \biggl( \bm{T_3^H} \biggr)_{sis''i''} \underbrace{ \frac{ \partial \biggl( \bm{{E\tu}} \biggr)_{s''i''} }{ \partial \biggl( \bbeta \biggr)_{s'i'a'} } }_{ 
			\mathclap{ = \biggl[ \bigl( \bm{{\tu}} \bigr)_{s''i''\ba''} \bigl( \bm{T_4^J} \bigr)_{s''i''\ba''s'i'a'} \prod\limits_{i'''} \bigl( \bsigma \bigr)_{s''i'''a_{i'''}''} \biggr]_{s''i''s'i'a'} } } \Biggr]_{sis'i'a'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{V}} \biggr)_{si} }{ \partial \biggl( \bV \biggr)_{s'i'} } \;=\; &
		\biggl( \bm{T_5^J} \biggr)_{sis'i'} \quad+\quad 
			\Biggl[ - \biggl( \bm{T_3^H} \biggr)_{sis''i''} \underbrace{ \frac{ \partial \biggl( \bm{{E\tu}} \biggr)_{s''i''} }{ \partial \biggl( \bV \biggr)_{s'i'} } }_{ 
				\mathclap{ = \biggl[ \quad \bigl( \bsigma \bigr)_{s''i''a} \frac{ \partial \bigl( \bm{{E\tu^a}} \bigr)_{s''i''a} }{ \partial \bigl( \bV \bigr)_{s'i'} } \quad \biggr]_{s''i''s'i'} } } \Biggr]_{sis'i'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{V}} \biggr)_{si} }{ \partial \lambda } \;=\; &
		\biggl( \bzero \biggr)_{si}
\end{align*}
with
\begin{align*}
	& \biggl( \bm{T_0^J} \biggr)_{sias'i'a'} \;\; = 
		\Biggl[ \biggl( \bm{T_2^H}\biggr)_{sias''i''a''} \biggl( \id_{\{s''=s',i''=i',a''=a'\}} \biggr)_{s''i''a''s'i'a'} \Biggr]_{sias'i'a'} \\
	& \biggl( \bm{T_1^J} \biggr)_{sias'i'a'} \;\; = 
		\Biggl[ \biggl( \bm{T_1^H}\biggr)_{sias''i''a''} \biggl( \id_{\{s''=s',i''=i',a''=a'\}} \biggr)_{s''i''a''s'i'a'} \Biggr]_{sias'i'a'} \\
	& \biggl( \bm{T_2^J}\biggr)_{si\ba_{\minusi}s'i'a'} = 
		\biggl( \id_{\{s=s',i\neq i',a_{i}=a'\}} \biggr)_{si\ba_{\minusi}s'i'a'} \\
	& \biggl( \bm{T_3^J} \biggr)_{si\ba s'i'} \quad\, =
		\Biggl[ \biggl( \bm{\phi} \biggr)_{si\ba s''}\biggl( \id_{\{s''=s',i=i'\}} \biggr)_{s''is'i'} \Biggr]_{si\ba s'i'} \\
	& \biggl( \bm{T_4^J}\biggr)_{si\ba s'i'a'} \;\: =
		\biggl( \id_{\{s=s',a_{i}=a'\}} \biggr)_{si\ba s'i'a'} \\
	& \biggl( \bm{T_5^J}\biggr)_{sis'i'} \quad\;\; = 
		\Biggl[ \biggl( \bm{T_3^H} \biggr)_{sis''i''} \biggl( \id_{\{s''=s',i''=i'\}} \biggr)_{s''i''s'i'} \Biggr]_{sis'i'}
\end{align*}






\newpage
\section{Stochastic Logarithmic Tracing Procedure}


\subsection{Version 1: $\eta(t) = (1-t)\eta_0$ (Default)}


\subsection*{Homotopy Function}

The homotopy function $H: \R^{n+1} \rightarrow \R^n$ is based on \citet[eqn.~X, p.~Y]{Eibelshaeuseretal2021LogTracing}, but parameterized in log strategies $\bbeta = \log(\bsigma)$ and using $\eta(t) = (1-t)\eta_0$ with small $\eta_0>0$.
\begin{align*}
	H(\bbeta,\bV,t) \;=\;
	\begin{pmatrix} 
		H^{V}(\bbeta,\bV,t) \\ 
		H^{\sigma}(\bbeta,\bV,t) 
	\end{pmatrix}
\end{align*}
with
\begin{align*}
	& \begin{aligned}
		H^V_{sia}(\bbeta,\bV,t) & \;=\; - V_{si} + \bar{u}_{si}^t(a,\bbeta_{s,\minusi}) + \delta_i \sum\limits_{\mathclap{s'\in S}} \barphiss^t(a,\bbeta_{s,\minusi}) \; V_{s'i} \\
		& \qquad \;+\; (1-t)^2\eta_0 \biggl( \nu_{sia} \exp(-\beta_{sia}) + \sum\limits_{\mathclap{a'\in A_{si}}} \nu_{sia'} \bigl[ \beta_{sia'} - 1 \bigr] \biggr)
	\end{aligned} && s\in S, i\in I, a\in A_{si} \\
	& H^\sigma_{si}(\bbeta,\bV,t) \;\; \;=\; \sum\limits_{\mathclap{a\in A_{si}}} \exp(\beta_{sia}) \:-\: 1 && s\in S, i\in I
\end{align*}
where
\begin{align*}
	\bar{u}_{si}^t(a,\bbeta_{s,\minusi}) & \;=\; tu_{si}(a,\bbeta_{s,\minusi}) + (1-t)u_{si}(a,\brho_{s,\minusi}) \\
	\barphiss^t(a,\bbeta_{s,\minusi}) & \;=\; t\phiss(a,\bbeta_{s,\minusi}) + (1-t)\phiss(a,\brho_{s,\minusi})
\end{align*}
and $\brho$ denotes profiles of prior beliefs, and $\bnu$ denotes the individual weights of the logarithmic penalty terms and $\eta$ denotes the overall scale of the logarithmic distortion.


\subsection*{Jacobian Matrix}

$J: \R^{n+1} \rightarrow \R^n \times \R^{n+1}$:
\begin{align*}
	J(\bbeta,\bV,t) \;=\; 
		\begin{pmatrix}
			\frac{ \partial H^V_{sia}(\bbeta,\bV,t) }{ \partial\beta_{s'i'a'} } 
				& \frac{ \partial H^V_{sia}(\bbeta,\bV,t) }{ \partial V_{s'i'} } 
				& \frac{ \partial H^V_{sia}(\bbeta,\bV,t) }{ \partial t } \\[1em] 
			\frac{ \partial H^\sigma_{si}(\bbeta,\bV,t) }{ \partial \beta_{s'i'a'} } 
				& \frac{ \partial H^\sigma_{si}(\bbeta,\bV,t) }{ \partial V_{s'i'} } 
				& \frac{ \partial H^\sigma_{si}(\bbeta,\bV,t) }{ \partial t }
		\end{pmatrix} 
\end{align*}
with
\begin{align*}
	\frac{ \partial H^V_{sia}(\bbeta,\bV,t) }{ \partial \beta_{s'i'a'} } \;=\; 
		\begin{cases}
			\begin{aligned}
				& (1-t)^2\eta_0 \nu_{sia} \bigl[1-\exp(-\beta_{sia})\bigr]
			\end{aligned} & 
			\begin{aligned}
				& \text{if } s'=s, i'=i \\ &\text{and } a'=a
			\end{aligned} \\[1em]
			\begin{aligned}
				& (1-t)^2\eta_0 \nu_{sia'}
			\end{aligned} & 
			\begin{aligned}
				& \text{if } s'=s, i'=i \\ &\text{and } a'\neq a
			\end{aligned} \\[1em]
			\begin{aligned} 
				& t \, \exp(\beta_{si'a'}) \biggl( u_{si}\bigl(a_{si},a_{si'}',\bbeta_{s,\shortminus\{i,i'\}}\bigr) \\
				& \qquad + \delta_i \sum\limits_{\mathclap{s''\in S}} \phi_{s\shortrightarrow s''}\bigl(a_{si},a_{si'}',\bbeta_{s,\shortminus\{i,i'\}}\bigr) \; V_{s''i} \biggr)
			\end{aligned} & 
			\begin{aligned}
				& \text{if } s'=s \\ &\text{and } i'\neq i  
			\end{aligned} \\[1em]
			0 & \text{else}
		\end{cases}
\end{align*}
\begin{align*}
	\frac{ \partial H^V_{sia}(\bbeta,\bV,t) }{ \partial V_{s'i'} } \;=\;
		\begin{cases}
			\delta_i \barphiss^t(a,\bbeta_{s,\minusi}) - 1 &\text{if } i'=i \text{ and } s'=s \\
			\delta_i \barphiss^t(a,\bbeta_{s,\minusi}) &\text{if } i'=i \text{ and } s'\neq s \\
			0 &\text{if } i'\neq i
		\end{cases}
\end{align*}
\begin{align*}
	\frac{\partial H^V_{sia}(\bbeta,\bV,t) }{ \partial t } & \;=\; 
		u_{si}(a,\bbeta_{s,\minusi}) - u_{si}\bigl(a,\log(\brho_{s,\minusi})\bigr) \\
		& \qquad \;+\; \delta_i \sum\limits_{s'\in S} \bigl[ \phiss(a,\bbeta_{s,\minusi}) - \phiss\bigl(a,\log(\brho_{s,\minusi})\bigr) \bigr] \; V_{s'i} \\
		& \qquad \;-\; 2(1-t)\eta_0 \biggl( \nu_{sia}\exp(-\beta_{sia}) + \sum\limits_{\mathclap{a'\in A_{si}}} \nu_{sia'} \bigl[ \beta_{sia'} - 1 \bigr] \biggr)
\end{align*}

\begin{align*}
	\frac{ \partial H^\sigma_{si}(\bbeta,\bV,t) }{ \partial \beta_{s'i'a'}} \;=\; 
		\begin{cases}
			\exp(\beta_{sia'}) \qquad&\text{if } s'=s \text{ and } i'=i \\
			0 \qquad&\text{else}  
		\end{cases}
\end{align*}
\begin{align*}
	\frac{ \partial H^\sigma_{si}(\bbeta,\bV,t) }{ \partial V_{s'i'} } \quad=\quad \frac{ \partial H^\sigma_{si}(\bbeta,\bV,t) }{ \partial t } \quad=\quad 0
\end{align*}




\subsection*{Tensor Notation}


\subsubsection*{Primitives}

\begin{align*}
	\biggl( \bbeta \biggr)_{sia} & \;:=\; \biggl( \beta_{sia} \biggr)_{s\in S, i\in I,a \in A_{si}} \\
	\biggl( \bsigma \biggr)_{sia} & \;:=\; \biggl( \exp(\beta_{sia}) \biggr)_{s\in S, i\in I,a \in A_{si}} \\
	\biggl( \bsigma^{-1} \biggr)_{sia} & \;:=\; \biggl( \exp(-\beta_{sia}) \biggr)_{s\in S, i\in I,a \in A_{si}} \\
	\biggl( \brho \biggr)_{sia} & \;:=\; \biggl( \rho_{sia} \biggr)_{s\in S, i\in I, a\in A_{s,i}} \\
	\biggl( \bnu \biggr)_{sia} & \;:=\; \biggl( \nu_{sia} \biggr)_{s\in S, i\in I, a\in A_{si}} \\
	\biggl( \bnu\bigl[\bbeta-\bone\bigr] \biggr)_{sia} & \;:=\; \biggl( \nu_{sia}\bigl[\beta_{sia}-1\bigr] \biggr)_{s\in S, i\in I, a\in A_{si}} \\
	\biggl( \bm{u} \biggr)_{si\ba} & \;:=\; \biggl( u_{si}(\ba) \biggr)_{s\in S, i\in I, \ba\in A} \\
	\biggl( \bV \biggr)_{si} & \;:=\; \biggl( V_{si} \biggr)_{s\in S, i\in I}
\end{align*}
Transition probabilities including individual discount factors:
\begin{align*}
	\biggl( \bm{\phi} \biggr)_{si\ba s'} & \;:=\; \biggl( \delta_i \; \phiss(\ba) \biggr)_{s\in S, i\in I, \ba\in A}
\end{align*}
Transition probabilities in auxiliary game:
\begin{align*}
	\biggl( \bm{\phi^{\sigma}} \biggr)_{sias'} & \;:=\; \left[ \quad \biggl( \bm{\phi} \biggr)_{si\ba s'} \; \prod\limits_{i'\neq i} \biggl( \bsigma \biggr)_{si'a_{i'}} \quad \right]_{sias'} \\
	\biggl( \bm{\phi^{\rho}} \biggr)_{sias'} & \;:=\; \left[ \quad \biggl( \bm{\phi} \biggr)_{si\ba s'} \; \prod\limits_{i'\neq i} \biggl( \brho \biggr)_{si'a_{i'}} \quad \right]_{sias'} \\
	\biggl( \bm{{\bar{\phi}^t}} \biggr)_{sias'} & \;:=\; t \; \biggl( \bm{\phi^{\sigma}} \biggr)_{sias'} \;+\; (1-t) \; \biggl( \bm{\phi^{\rho}} \biggr)_{sias'}
\end{align*}
Discounted payoffs in auxiliary game:
\begin{align*}
	\biggl( \bm{u^{\sigma}} \biggr)_{sia} & \;:=\; \left[ \quad \biggl( \bm{u} \biggr)_{si\ba} \cdot \prod\limits_{i'\neq i} \biggl( \bsigma \biggr)_{si'a_{i'}} \quad \right]_{sia} \\
	\biggl( \bm{u^{\rho}} \biggr)_{sia} & \;:=\; \left[ \quad \biggl( \bm{u} \biggr)_{si\ba} \; \prod\limits_{i'\neq i} \biggl( \brho \biggr)_{si'a_{i'}} \quad \right]_{sia} \\
	\biggl( \bm{{\bar{u}^t}} \biggr)_{sia} & \;:=\; t \; \biggl( \bm{u^{\sigma}} \biggr)_{sia} \;+\; (1-t) \; \biggl( \bm{u^{\rho}} \biggr)_{sia}
\end{align*}
Expected discounted payoffs in auxiliary game for player $i$ in state $s$ playing action $a$ while all other players $i'\neq i$ play according to $\bsigma$:
\begin{align*}
	\biggl( \bm{{E\tu^{a}}} \biggr)_{sia} & \;:=\; \biggl( \bm{{\bar{u}^t}} \biggr)_{sia} \;+\; \left[ \quad \biggl( \bm{{\bar{\phi}^t}} \biggr)_{sias'} \; \biggl( \bV \biggr)_{s'i} \quad \right]_{sia}
\end{align*}
Expected discounted payoffs for player $i$ in state $s$ when player $i$ plays action $a$ and player $i'$ plays action $a'$ and all other players $i'' \neq i, i'$ play according to $\bsigma$. \\
Note 1: Here, expectation taken w.r.t.\ actual strategies; no beliefs involved. \\
Note 2: The case $i'=i$ is explicitly included to allow for decision problems with $|I|=1$.
\begin{align*}
	\biggl( \bm{{\tu}} \biggr)_{si\ba} & \;:=\; \biggl( \bm{u} \biggr)_{si\ba} \;+\; \left[ \quad \biggl( \bm{\phi} \biggr)_{si\ba s'} \; \biggl( \bV \biggr)_{s'i} \quad \right]_{si\ba} \\
	\biggl( \bm{{E\tu^{a,a'}}} \biggr)_{sii'aa'} & \;:=\; \left[ \quad \biggl( \bm{{\tu}} \biggr)_{si\ba} \; \prod\limits_{i''\neq i,i'} \biggl( \bsigma \biggr)_{si''a_{i''}} \quad \right]_{sii'aa'}
\end{align*} 


\subsubsection*{Homotopy Function}

\begin{align*}
	\biggl( \bm{H^{V}} \biggr)_{sia} & \;=\; 
		\biggl( \bm{{E\tu^{a}}} \biggr)_{sia} \;-\; \Biggl[ \biggl( \bone \biggr)_{sia} \; \biggl( \bV \biggr)_{si} \Biggr]_{sia} \\
		& \qquad \;+\; (1-t)^2 \: \eta_0 \; \left( \Biggl[ \biggl( \bnu \biggr)_{sia} \biggl( \bsigma^{-1} \biggr) \Biggr]_{sia} + \Biggl[ \biggl( \bone \biggr)_{sia} \Biggl[ \biggl( \bnu\bigl[\bbeta-\bone\bigr] \biggr)_{sia} \Biggr]_{si} \Biggr]_{sia} \right)
\end{align*}
\begin{align*}
	\biggl( \bm{H^{\sigma}} \biggr)_{si} & \;=\; 
		\Biggl[ \biggl( \bsigma \biggr)_{sia} \Biggr]_{si} \;-\; \biggl( \bone \biggr)_{si} 
\end{align*}


\subsubsection*{Jacobian Matrix} 

\begin{align*}
	\frac{ \partial \biggl( \bm{H^{V}} \biggr)_{sia} }{ \partial \biggl( \bbeta \biggr)_{s'i'a'} } & \;=\; 
		(1-t)^2 \: \eta_0 \; \left[ \biggl( \bm{T_0^J} \biggr)_{sias'i'a'} \; \Biggl[ \biggl( \bnu \biggr)_{s'i'a'} \Biggl( \biggl( \bone \biggr)_{s'i'a'} - \biggl( \bsigma^{-1} \biggr)_{s'i'a'} \Biggr) \Biggr]_{s'i'a'} \right]_{sias'i'a'} \\
		& \qquad \;+\;  (1-t)^2 \: \eta_0 \; \Biggl[ \biggl( \bm{T_1^J} \biggr)_{sias'i'a'} \biggl( \bnu \biggr)_{sia'} \Biggr]_{sias'i'a'} \\
		& \qquad \;+\; t \; \Biggl[ \biggl( \bm{T_2^J} \biggr)_{sias'i'a'} \biggl( \bsigma \biggr)_{si'a'} \biggl( \bm{{E\tu^{a,a'}}} \biggr)_{sii'aa'} \Biggr]_{sias'i'a'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{V}} \biggr)_{sia} }{ \partial \biggl( \bV \biggr)_{s'i'} } & \;=\; 
		\Biggl[ \biggl( \bm{T_3^J} \biggr)_{sias'i'} \biggl( \bm{{\bar{\phi}^t}} \biggr)_{sias'} \Biggr]_{sias'i'} - \biggl( \bm{T_4^J} \biggr)_{sias'i'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{V}} \biggr)_{sia} }{ \partial t } & \;=\; 
		\biggl( \bm{u^{\sigma}} - \bm{u^{\rho}} \biggr)_{sia} + \Biggl[ \biggl( \bm{\phi^{\sigma}} - \bm{\phi^{\rho}} \biggr)_{sias'} \biggl( \bV \biggr)_{s'i} \Biggr]_{sia} \\
		& \qquad \;-\; 2(1-t) \: \eta_0 \; \left( \Biggl[ \biggl( \bnu \biggr)_{sia} \biggl( \bsigma^{-1} \biggr)_{sia} \Biggr]_{sia} + \Biggl[ \biggl( \bone \biggr)_{sia} \Biggl[ \biggl( \bnu\bigl[\bbeta-\bone\bigr] \biggr)_{sia} \Biggr]_{si} \Biggr]_{sia} \right)
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{\sigma}} \biggr)_{si} }{ \partial \biggl( \bbeta \biggr)_{s'i'a'} } \;=\; 
	\Biggl[ \biggl( \bm{T_5^J} \biggr)_{sis'i'a'} \biggl( \bsigma \biggr)_{s'i'a'} \Biggr]_{sis'i'a'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{\sigma}} \biggr)_{si} }{ \partial \biggl( \bV \biggr)_{s'i'} } \;=\; \biggl( \bzero \biggr)_{sis'i'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{\sigma}} \biggr)_{si} }{ \partial t } \;=\; \biggl( \bzero \biggr)_{si}
\end{align*}
with
\begin{align*}
	& \biggl( \bm{T_0^J} \biggr)_{sias'i'a'} = \biggl( \id_{\{s'=s,i'=i,a'=a\}} \biggr)_{sias'i'a'} \\
	& \biggl( \bm{T_1^J} \biggr)_{sias'i'a'} = \biggl( \id_{\{s'=s,i'=i,a'\neq a\}} \biggr)_{sias'i'a'} \\
	& \biggl( \bm{T_2^J} \biggr)_{sias'i'a'} = \biggl( \id_{\{s'=s,i'\neq i\}} \biggr)_{sias'i'a'} \\
	& \biggl( \bm{T_3^J} \biggr)_{sias'i'} = \biggl( \id_{\{i'=i\}} \biggr)_{sias'i'} \\
	& \biggl( \bm{T_4^J} \biggr)_{sias'i'} = \biggl( \id_{\{s'=s,i'=i\}} \biggr)_{sias'i'} \\
	& \biggl( \bm{T_5^J} \biggr)_{sis'i'a'} = \biggl( \id_{\{s'=s,i'=i\}} \biggr)_{sis'i'a'}
\end{align*}




\subsection{Version 2: $\eta$ fix}


\subsection*{Homotopy Function}

\begin{align*}
	& \begin{aligned}
		H^V_{sia}(\bbeta,\bV,t) & \;=\; - V_{si} + \bar{u}_{si}^t(a,\bbeta_{s,\minusi}) + \delta_i \sum\limits_{\mathclap{s'\in S}} \barphiss^t(a,\bbeta_{s,\minusi}) \; V_{s'i} \\
		& \qquad \;+\; (1-t)\eta \biggl( \nu_{sia} \exp(-\beta_{sia}) + \sum\limits_{\mathclap{a'\in A_{si}}} \nu_{sia'} \bigl[ \beta_{sia'} - 1 \bigr] \biggr)
	\end{aligned} && s\in S, i\in I, a\in A_{si} \\
	& H^\sigma_{si}(\bbeta,\bV,t) \;\; \;=\; \sum\limits_{\mathclap{a\in A_{si}}} \exp(\beta_{sia}) \:-\: 1 && s\in S, i\in I
\end{align*}


\subsection*{Jacobian Matrix}

\begin{align*}
	\frac{ \partial H^V_{sia}(\bbeta,\bV,t) }{ \partial \beta_{s'i'a'} } \;=\; 
		\begin{cases}
			\begin{aligned}
				& (1-t)\eta \nu_{sia} \bigl[1-\exp(-\beta_{sia})\bigr]
			\end{aligned} & 
			\begin{aligned}
				& \text{if } s'=s, i'=i \\ &\text{and } a'=a
			\end{aligned} \\[1em]
			\begin{aligned}
				& (1-t)\eta \nu_{sia'}
			\end{aligned} & 
			\begin{aligned}
				& \text{if } s'=s, i'=i \\ &\text{and } a'\neq a
			\end{aligned} \\[1em]
			\begin{aligned} 
				& t \, \exp(\beta_{si'a'}) \biggl( u_{si}\bigl(a_{si},a_{si'}',\bbeta_{s,\shortminus\{i,i'\}}\bigr) \\
				& \qquad + \delta_i \sum\limits_{\mathclap{s''\in S}} \phi_{s\shortrightarrow s''}\bigl(a_{si},a_{si'}',\bbeta_{s,\shortminus\{i,i'\}}\bigr) \; V_{s''i} \biggr)
			\end{aligned} & 
			\begin{aligned}
				& \text{if } s'=s \\ &\text{and } i'\neq i  
			\end{aligned} \\[1em]
			0 & \text{else}
		\end{cases}
\end{align*}
\begin{align*}
	\frac{ \partial H^V_{sia}(\bbeta,\bV,t) }{ \partial V_{s'i'} } \;=\;
		\begin{cases}
			\delta_i \barphiss^t(a,\bbeta_{s,\minusi}) - 1 &\text{if } i'=i \text{ and } s'=s \\
			\delta_i \barphiss^t(a,\bbeta_{s,\minusi}) &\text{if } i'=i \text{ and } s'\neq s \\
			0 &\text{if } i'\neq i
		\end{cases}
\end{align*}
\begin{align*}
	\frac{\partial H^V_{sia}(\bbeta,\bV,t) }{ \partial t } & \;=\; 
		u_{si}(a,\bbeta_{s,\minusi}) - u_{si}\bigl(a,\log(\brho_{s,\minusi})\bigr) \\
		& \qquad \;+\; \delta_i \sum\limits_{s'\in S} \bigl[ \phiss(a,\bbeta_{s,\minusi}) - \phiss\bigl(a,\log(\brho_{s,\minusi})\bigr) \bigr] \; V_{s'i} \\
		& \qquad \;-\; \eta \biggl( \nu_{sia}\exp(-\beta_{sia}) + \sum\limits_{\mathclap{a'\in A_{si}}} \nu_{sia'} \bigl[ \beta_{sia'} - 1 \bigr] \biggr)
\end{align*}

\begin{align*}
	\frac{ \partial H^\sigma_{si}(\bbeta,\bV,t) }{ \partial \beta_{s'i'a'}} \;=\; 
		\begin{cases}
			\exp(\beta_{sia'}) \qquad&\text{if } s'=s \text{ and } i'=i \\
			0 \qquad&\text{else}  
		\end{cases}
\end{align*}
\begin{align*}
	\frac{ \partial H^\sigma_{si}(\bbeta,\bV,t) }{ \partial V_{s'i'} } \quad=\quad \frac{ \partial H^\sigma_{si}(\bbeta,\bV,t) }{ \partial t } \quad=\quad 0
\end{align*}




\subsection*{Tensor Notation}


\subsubsection*{Homotopy Function}

\begin{align*}
	\biggl( \bm{H^{V}} \biggr)_{sia} & \;=\; 
		\biggl( \bm{{E\tu^{a}}} \biggr)_{sia} \;-\; \Biggl[ \biggl( \bone \biggr)_{sia} \; \biggl( \bV \biggr)_{si} \Biggr]_{sia} \\
		& \qquad \;+\; (1-t) \: \eta \; \left( \Biggl[ \biggl( \bnu \biggr)_{sia} \biggl( \bsigma^{-1} \biggr) \Biggr]_{sia} + \Biggl[ \biggl( \bone \biggr)_{sia} \Biggl[ \biggl( \bnu\bigl[\bbeta-\bone\bigr] \biggr)_{sia} \Biggr]_{si} \Biggr]_{sia} \right)
\end{align*}
\begin{align*}
	\biggl( \bm{H^{\sigma}} \biggr)_{si} & \;=\; 
		\Biggl[ \biggl( \bsigma \biggr)_{sia} \Biggr]_{si} \;-\; \biggl( \bone \biggr)_{si} 
\end{align*}


\subsubsection*{Jacobian Matrix} 

\begin{align*}
	\frac{ \partial \biggl( \bm{H^{V}} \biggr)_{sia} }{ \partial \biggl( \bbeta \biggr)_{s'i'a'} } & \;=\; 
		\left[ \biggl( \bm{T_0^J} \biggr)_{sias'i'a'} \left( \biggl( \bm{{E\tu^{a}}} \biggr)_{s'i'a'} \;-\; \Biggl[ \biggl( \bone \biggr)_{s'i'a'} \; \biggl( \bV \biggr)_{s'i'} \Biggr]_{s'i'a'} \right) \right]_{sias'i'a'} \\
		& \qquad \;+\; (1-t) \: \eta \; \left[ \biggl( \bm{T_0^J} \biggr)_{sias'i'a'} \; \Biggl[ \biggl( \bnu \biggr)_{s'i'a'} \Biggl( \biggl( \bone \biggr)_{s'i'a'} - \biggl( \bsigma^{-1} \biggr)_{s'i'a'} \Biggr) \Biggr]_{s'i'a'} \right]_{sias'i'a'} \\
		& \qquad \;+\;  (1-t) \: \eta \; \Biggl[ \biggl( \bm{T_1^J} \biggr)_{sias'i'a'} \biggl( \bnu \biggr)_{sia'} \Biggr]_{sias'i'a'} \\
		& \qquad \;+\; t \; \Biggl[ \biggl( \bm{T_2^J} \biggr)_{sias'i'a'} \biggl( \bsigma \biggr)_{si'a'} \biggl( \bm{{E\tu^{a,a'}}} \biggr)_{sii'aa'} \Biggr]_{sias'i'a'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{V}} \biggr)_{sia} }{ \partial \biggl( \bV \biggr)_{s'i'} } & \;=\; 
		\Biggl[ \biggl( \bm{T_3^J} \biggr)_{sias'i'} \biggl( \bm{{\bar{\phi}^t}} \biggr)_{sias'} \Biggr]_{sias'i'} - \biggl( \bm{T_4^J} \biggr)_{sias'i'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{V}} \biggr)_{sia} }{ \partial t } & \;=\; 
		\biggl( \bm{u^{\sigma}} - \bm{u^{\rho}} \biggr)_{sia} + \Biggl[ \biggl( \bm{\phi^{\sigma}} - \bm{\phi^{\rho}} \biggr)_{sias'} \biggl( \bV \biggr)_{s'i} \Biggr]_{sia} \\
		& \qquad \;-\; \eta \; \left( \Biggl[ \biggl( \bnu \biggr)_{sia} \biggl( \bsigma^{-1} \biggr)_{sia} \Biggr]_{sia} + \Biggl[ \biggl( \bone \biggr)_{sia} \Biggl[ \biggl( \bnu\bigl[\bbeta-\bone\bigr] \biggr)_{sia} \Biggr]_{si} \Biggr]_{sia} \right)
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{\sigma}} \biggr)_{si} }{ \partial \biggl( \bbeta \biggr)_{s'i'a'} } \;=\; 
	\Biggl[ \biggl( \bm{T_5^J} \biggr)_{sis'i'a'} \biggl( \bsigma \biggr)_{s'i'a'} \Biggr]_{sis'i'a'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{\sigma}} \biggr)_{si} }{ \partial \biggl( \bV \biggr)_{s'i'} } \;=\; \biggl( \bzero \biggr)_{sis'i'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{\sigma}} \biggr)_{si} }{ \partial t } \;=\; \biggl( \bzero \biggr)_{si}
\end{align*}
with $\biggl(\bm{T_0^J}\biggr), \dots, \biggl(\bm{T_5^J}\biggr)$ as above.




\subsection{Version 3: Agent Variation with $\eta(t) = (1-t)\eta_0$}

An ``agent'' $(s,i)$ is a state-player tuple. In the agent variation, agents are treated as independent in the sense that beliefs are uncorrelated across agents. By contrast, in the original tracing procedure, beliefs are \emph{correlated} across players. (In both variations, beliefs are uncorrelated across time in order to make the notion of stationary equilibrium meaningful.)

The agent variation is closely linked to stochastic quantal response equilibrium which also treats agents as independent.

The agent variation can be implemented more efficiently than the original version. Both agree in case of at most two players, but are generally different in games with more than two players.


\subsection*{Homotopy Function}

Denote mixed log beliefs as $\bar{\bbeta}^t = t\bbeta + (1-t)\log(\brho)$.

\subsection*{Homotopy Function}

\begin{align*}
	& \begin{aligned}
		H^V_{sia}(\bbeta,\bV,t) & \;=\; - V_{si} + u_{si}(a,\bar{\bbeta}^t_{s,\minusi}) + \delta_i \sum\limits_{\mathclap{s'\in S}} \phiss(a,\bar{\bbeta}^t_{s,\minusi}) \; V_{s'i} \\
		& \qquad \;+\; (1-t)^2\eta_0 \biggl( \nu_{sia} \exp(-\beta_{sia}) + \sum\limits_{\mathclap{a'\in A_{si}}} \nu_{sia'} \bigl[ \beta_{sia'} - 1 \bigr] \biggr)
	\end{aligned} && s\in S, i\in I, a\in A_{si} \\
	& H^\sigma_{si}(\bbeta,\bV,t) \;\; \;=\; \sum\limits_{\mathclap{a\in A_{si}}} \exp(\beta_{sia}) \:-\: 1 && s\in S, i\in I
\end{align*}


\subsection*{Jacobian Matrix}

\begin{align*}
	\frac{ \partial H^V_{sia}(\bbeta,\bV,t) }{ \partial \beta_{s'i'a'} } \;=\; 
		\begin{cases}
			\begin{aligned}
				& (1-t)^2\eta_0 \nu_{sia} \bigl[1-\exp(-\beta_{sia})\bigr]
			\end{aligned} & 
			\begin{aligned}
				& \text{if } s'=s, i'=i \\ &\text{and } a'=a
			\end{aligned} \\[1em]
			\begin{aligned}
				& (1-t)^2\eta_0 \nu_{sia'}
			\end{aligned} & 
			\begin{aligned}
				& \text{if } s'=s, i'=i \\ &\text{and } a'\neq a
			\end{aligned} \\[1em]
			\begin{aligned} 
				& t \, \exp(\beta_{si'a'}) \biggl( u_{si}\bigl(a_{si},a_{si'}',\bar{\bbeta}^t_{s,\shortminus\{i,i'\}}\bigr) \\
				& \qquad + \delta_i \sum\limits_{\mathclap{s''\in S}} \phi_{s\shortrightarrow s''}\bigl(a_{si},a_{si'}',\bar{\bbeta}^t_{s,\shortminus\{i,i'\}}\bigr) \; V_{s''i} \biggr)
			\end{aligned} & 
			\begin{aligned}
				& \text{if } s'=s \\ &\text{and } i'\neq i  
			\end{aligned} \\[1em]
			0 & \text{else}
		\end{cases}
\end{align*}
\begin{align*}
	\frac{ \partial H^V_{sia}(\bbeta,\bV,t) }{ \partial V_{s'i'} } \;=\;
		\begin{cases}
			\delta_i \phiss(a,\bar{\bbeta}^t_{s,\minusi}) - 1 &\text{if } i'=i \text{ and } s'=s \\
			\delta_i \phiss^t(a,\bar{\bbeta}^t_{s,\minusi}) &\text{if } i'=i \text{ and } s'\neq s \\
			0 &\text{if } i'\neq i
		\end{cases}
\end{align*}
\begin{align*}
	\frac{\partial H^V_{sia}(\bbeta,\bV,t) }{ \partial t } & \;=\; 
		u_{si}\bigl(a,\bbeta_{s,\minusi} \mediumminus \log(\brho_{s,\minusi})\bigr) \;+\; \delta_i \sum\limits_{s'\in S} \phiss\bigl(a,\bbeta_{s,\minusi} \mediumminus \log(\brho_{s,\minusi})\bigr) \; V_{s'i} \\
		& \qquad \;-\; 2(1-t)\eta_0 \biggl( \nu_{sia}\exp(-\beta_{sia}) + \sum\limits_{\mathclap{a'\in A_{si}}} \nu_{sia'} \bigl[ \beta_{sia'} - 1 \bigr] \biggr)
\end{align*}

\begin{align*}
	\frac{ \partial H^\sigma_{si}(\bbeta,\bV,t) }{ \partial \beta_{s'i'a'}} \;=\; 
		\begin{cases}
			\exp(\beta_{sia'}) \qquad&\text{if } s'=s \text{ and } i'=i \\
			0 \qquad&\text{else}  
		\end{cases}
\end{align*}
\begin{align*}
	\frac{ \partial H^\sigma_{si}(\bbeta,\bV,t) }{ \partial V_{s'i'} } \quad=\quad \frac{ \partial H^\sigma_{si}(\bbeta,\bV,t) }{ \partial t } \quad=\quad 0
\end{align*}




\subsection*{Tensor Notation}


\subsection*{Additional Primitives}

Beliefs in auxiliary game:
\begin{align*}
	\biggl( \bar{\bsigma}^t \biggr)_{sia} \;:=\; t \; \biggl( \bsigma \biggr)_{sia} \;+\; (1-t) \; \biggl( \brho \biggr)_{sia}
\end{align*}
Transition probabilities in auxiliary game:
\begin{align*}
	\biggl( \bm{\phi}(\bar{\bsigma}^t) \biggr)_{sias'} \;:=\; \left[ \quad \biggl( \bm{\phi} \biggr)_{si\ba s'} \; \prod\limits_{i'\neq i} \biggl( \bar{\bsigma}^t \biggr)_{si'a_{i'}} \quad \right]_{sias'}
\end{align*}
Discounted payoffs in auxiliary game:
\begin{align*}
	& \biggl( \bm{{E\tu^{a}}}(\bar{\bsigma}^t) \biggr)_{sia} \;:=\; \left[ \quad \biggl( \tu \biggr)_{si\ba} \; \prod\limits_{i'\neq i} \biggl( \bar{\bsigma}^t \biggr)_{si'a_{i'}} \quad \right]_{sia} \\
	& \biggl( \bm{{E\tu^{a}}}(\bsigma-\brho) \biggr)_{sia} \;:=\, \left[ \quad \biggl( \tu \biggr)_{si\ba} \; \prod\limits_{i'\neq i} \biggl( \bsigma-\brho \biggr)_{si'a_{i'}} \quad \right]_{sia}
\end{align*}
Expected dicounted payoffs in auxiliary game for player $i$ in state $s$ when player $i$ plays action $a$ and player $i'$ plays action $a'$ and all other players $i'' \neq i, i'$ play according to $\bar{\bsigma}^t$. The case $i'=i$ is explicitly included to allow for decision problems with $|I|=1$. 
\begin{align*}
	& \biggl( \bm{{E\tu^{a,a'}}}(\bar{\bsigma}^t) \biggr)_{sii'aa'} \;:=\; \left[ \quad \biggl( \tu \biggr)_{si\ba} \; \prod\limits_{i''\neq i,i'} \biggl( \bar{\bsigma}^t \biggr)_{si''a_{i''}} \quad \right]_{sii'aa'}
\end{align*}


\subsubsection*{Homotopy Function}

\begin{align*}
	\biggl( \bm{H^{V}} \biggr)_{sia} & \;=\; 
		\biggl( \bm{{E\tu^{a}}}(\bar{\bsigma}^t) \biggr)_{sia} \;-\; \Biggl[ \biggl( \bone \biggr)_{sia} \; \biggl( \bV \biggr)_{si} \Biggr]_{sia} \\
		& \qquad \;+\; (1-t)^2 \: \eta_0 \; \left( \Biggl[ \biggl( \bnu \biggr)_{sia} \biggl( \bsigma^{-1} \biggr) \Biggr]_{sia} + \Biggl[ \biggl( \bone \biggr)_{sia} \Biggl[ \biggl( \bnu\bigl[\bbeta-\bone\bigr] \biggr)_{sia} \Biggr]_{si} \Biggr]_{sia} \right)
\end{align*}
\begin{align*}
	\biggl( \bm{H^{\sigma}} \biggr)_{si} & \;=\; 
		\Biggl[ \biggl( \bsigma \biggr)_{sia} \Biggr]_{si} \;-\; \biggl( \bone \biggr)_{si} 
\end{align*}


\subsubsection*{Jacobian Matrix} 

\begin{align*}
	\frac{ \partial \biggl( \bm{H^{V}} \biggr)_{sia} }{ \partial \biggl( \bbeta \biggr)_{s'i'a'} } & \;=\; 
		(1-t)^2 \: \eta_0 \; \left[ \biggl( \bm{T_0^J} \biggr)_{sias'i'a'} \; \Biggl[ \biggl( \bnu \biggr)_{s'i'a'} \Biggl( \biggl( \bone \biggr)_{s'i'a'} - \biggl( \bsigma^{-1} \biggr)_{s'i'a'} \Biggr) \Biggr]_{s'i'a'} \right]_{sias'i'a'} \\
		& \qquad \;+\;  (1-t)^2 \: \eta_0 \; \Biggl[ \biggl( \bm{T_1^J} \biggr)_{sias'i'a'} \biggl( \bnu \biggr)_{sia'} \Biggr]_{sias'i'a'} \\
		& \qquad \;+\; t \; \Biggl[ \biggl( \bm{T_2^J} \biggr)_{sias'i'a'} \biggl( \bsigma \biggr)_{si'a'} \biggl( \bm{{E\tu^{a,a'}}}(\bar{\bsigma}^t) \biggr)_{sii'aa'} \Biggr]_{sias'i'a'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{V}} \biggr)_{sia} }{ \partial \biggl( \bV \biggr)_{s'i'} } & \;=\; 
		\Biggl[ \biggl( \bm{T_3^J} \biggr)_{sias'i'} \biggl( \bm{\phi}(\bar{\bsigma}^t) \biggr)_{sias'} \Biggr]_{sias'i'} - \biggl( \bm{T_4^J} \biggr)_{sias'i'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{V}} \biggr)_{sia} }{ \partial t } & \;=\; 
		\biggl( \bm{{E\tu^{a}}}(\bsigma-\brho) \biggr)_{sia} \\
		& \qquad \;-\; 2(1-t) \eta_0 \; \left( \Biggl[ \biggl( \bnu \biggr)_{sia} \biggl( \bsigma^{-1} \biggr)_{sia} \Biggr]_{sia} + \Biggl[ \biggl( \bone \biggr)_{sia} \Biggl[ \biggl( \bnu\bigl[\bbeta-\bone\bigr] \biggr)_{sia} \Biggr]_{si} \Biggr]_{sia} \right)
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{\sigma}} \biggr)_{si} }{ \partial \biggl( \bbeta \biggr)_{s'i'a'} } \;=\; 
	\Biggl[ \biggl( \bm{T_5^J} \biggr)_{sis'i'a'} \biggl( \bsigma \biggr)_{s'i'a'} \Biggr]_{sis'i'a'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{\sigma}} \biggr)_{si} }{ \partial \biggl( \bV \biggr)_{s'i'} } \;=\; \biggl( \bzero \biggr)_{sis'i'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{\sigma}} \biggr)_{si} }{ \partial t } \;=\; \biggl( \bzero \biggr)_{si}
\end{align*}
with $\biggl(\bm{T_0^J}\biggr), \dots, \biggl(\bm{T_5^J}\biggr)$ as above.




\subsection{Version 4: Agent Variation with $\eta$ fix}


\subsection*{Homotopy Function}

\begin{align*}
	& \begin{aligned}
		H^V_{sia}(\bbeta,\bV,t) & \;=\; - V_{si} + u_{si}(a,\bar{\bbeta}^t_{s,\minusi}) + \delta_i \sum\limits_{\mathclap{s'\in S}} \phiss(a,\bar{\bbeta}^t_{s,\minusi}) \; V_{s'i} \\
		& \qquad \;+\; (1-t)\eta \biggl( \nu_{sia} \exp(-\beta_{sia}) + \sum\limits_{\mathclap{a'\in A_{si}}} \nu_{sia'} \bigl[ \beta_{sia'} - 1 \bigr] \biggr)
	\end{aligned} && s\in S, i\in I, a\in A_{si} \\
	& H^\sigma_{si}(\bbeta,\bV,t) \;\; \;=\; \sum\limits_{\mathclap{a\in A_{si}}} \exp(\beta_{sia}) \:-\: 1 && s\in S, i\in I
\end{align*}


\subsection*{Jacobian Matrix}

\begin{align*}
	\frac{ \partial H^V_{sia}(\bbeta,\bV,t) }{ \partial \beta_{s'i'a'} } \;=\; 
		\begin{cases}
			\begin{aligned}
				& (1-t)\eta \nu_{sia} \bigl[1-\exp(-\beta_{sia})\bigr]
			\end{aligned} & 
			\begin{aligned}
				& \text{if } s'=s, i'=i \\ &\text{and } a'=a
			\end{aligned} \\[1em]
			\begin{aligned}
				& (1-t)\eta \nu_{sia'}
			\end{aligned} & 
			\begin{aligned}
				& \text{if } s'=s, i'=i \\ &\text{and } a'\neq a
			\end{aligned} \\[1em]
			\begin{aligned} 
				& t \, \exp(\beta_{si'a'}) \biggl( u_{si}\bigl(a_{si},a_{si'}',\bar{\bbeta}^t_{s,\shortminus\{i,i'\}}\bigr) \\
				& \qquad + \delta_i \sum\limits_{\mathclap{s''\in S}} \phi_{s\shortrightarrow s''}\bigl(a_{si},a_{si'}',\bar{\bbeta}^t_{s,\shortminus\{i,i'\}}\bigr) \; V_{s''i} \biggr)
			\end{aligned} & 
			\begin{aligned}
				& \text{if } s'=s \\ &\text{and } i'\neq i  
			\end{aligned} \\[1em]
			0 & \text{else}
		\end{cases}
\end{align*}
\begin{align*}
	\frac{ \partial H^V_{sia}(\bbeta,\bV,t) }{ \partial V_{s'i'} } \;=\;
		\begin{cases}
			\delta_i \phiss(a,\bar{\bbeta}^t_{s,\minusi}) - 1 &\text{if } i'=i \text{ and } s'=s \\
			\delta_i \phiss^t(a,\bar{\bbeta}^t_{s,\minusi}) &\text{if } i'=i \text{ and } s'\neq s \\
			0 &\text{if } i'\neq i
		\end{cases}
\end{align*}
\begin{align*}
	\frac{\partial H^V_{sia}(\bbeta,\bV,t) }{ \partial t } & \;=\; 
		u_{si}\bigl(a,\bbeta_{s,\minusi} \mediumminus \log(\brho_{s,\minusi})\bigr) \;+\; \delta_i \sum\limits_{s'\in S} \phiss\bigl(a,\bbeta_{s,\minusi} \mediumminus \log(\brho_{s,\minusi})\bigr) \; V_{s'i} \\
		& \qquad \;-\; \eta \biggl( \nu_{sia}\exp(-\beta_{sia}) + \sum\limits_{\mathclap{a'\in A_{si}}} \nu_{sia'} \bigl[ \beta_{sia'} - 1 \bigr] \biggr)
\end{align*}

\begin{align*}
	\frac{ \partial H^\sigma_{si}(\bbeta,\bV,t) }{ \partial \beta_{s'i'a'}} \;=\; 
		\begin{cases}
			\exp(\beta_{sia'}) \qquad&\text{if } s'=s \text{ and } i'=i \\
			0 \qquad&\text{else}  
		\end{cases}
\end{align*}
\begin{align*}
	\frac{ \partial H^\sigma_{si}(\bbeta,\bV,t) }{ \partial V_{s'i'} } \quad=\quad \frac{ \partial H^\sigma_{si}(\bbeta,\bV,t) }{ \partial t } \quad=\quad 0
\end{align*}




\subsection*{Tensor Notation}


\subsubsection*{Homotopy Function}

\begin{align*}
	\biggl( \bm{H^{V}} \biggr)_{sia} & \;=\; 
		\biggl( \bm{{E\tu^{a}}}(\bar{\bsigma}^t) \biggr)_{sia} \;-\; \Biggl[ \biggl( \bone \biggr)_{sia} \; \biggl( \bV \biggr)_{si} \Biggr]_{sia} \\
		& \qquad \;+\; (1-t) \: \eta \; \left( \Biggl[ \biggl( \bnu \biggr)_{sia} \biggl( \bsigma^{-1} \biggr) \Biggr]_{sia} + \Biggl[ \biggl( \bone \biggr)_{sia} \Biggl[ \biggl( \bnu\bigl[\bbeta-\bone\bigr] \biggr)_{sia} \Biggr]_{si} \Biggr]_{sia} \right)
\end{align*}
\begin{align*}
	\biggl( \bm{H^{\sigma}} \biggr)_{si} & \;=\; 
		\Biggl[ \biggl( \bsigma \biggr)_{sia} \Biggr]_{si} \;-\; \biggl( \bone \biggr)_{si} 
\end{align*}


\subsubsection*{Jacobian Matrix} 

\begin{align*}
	\frac{ \partial \biggl( \bm{H^{V}} \biggr)_{sia} }{ \partial \biggl( \bbeta \biggr)_{s'i'a'} } & \;=\; 
		(1-t) \: \eta \; \left[ \biggl( \bm{T_0^J} \biggr)_{sias'i'a'} \; \Biggl[ \biggl( \bnu \biggr)_{s'i'a'} \Biggl( \biggl( \bone \biggr)_{s'i'a'} - \biggl( \bsigma^{-1} \biggr)_{s'i'a'} \Biggr) \Biggr]_{s'i'a'} \right]_{sias'i'a'} \\
		& \qquad \;+\;  (1-t) \: \eta \; \Biggl[ \biggl( \bm{T_1^J} \biggr)_{sias'i'a'} \biggl( \bnu \biggr)_{sia'} \Biggr]_{sias'i'a'} \\
		& \qquad \;+\; t \; \Biggl[ \biggl( \bm{T_2^J} \biggr)_{sias'i'a'} \biggl( \bsigma \biggr)_{si'a'} \biggl( \bm{{E\tu^{a,a'}}}(\bar{\bsigma}^t) \biggr)_{sii'aa'} \Biggr]_{sias'i'a'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{V}} \biggr)_{sia} }{ \partial \biggl( \bV \biggr)_{s'i'} } & \;=\; 
		\Biggl[ \biggl( \bm{T_3^J} \biggr)_{sias'i'} \biggl( \bm{\phi}(\bar{\bsigma}^t) \biggr)_{sias'} \Biggr]_{sias'i'} - \biggl( \bm{T_4^J} \biggr)_{sias'i'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{V}} \biggr)_{sia} }{ \partial t } & \;=\; 
		\biggl( \bm{{E\tu^{a}}}(\bsigma-\brho) \biggr)_{sia} \\
		& \qquad \;-\; \eta \; \left( \Biggl[ \biggl( \bnu \biggr)_{sia} \biggl( \bsigma^{-1} \biggr)_{sia} \Biggr]_{sia} + \Biggl[ \biggl( \bone \biggr)_{sia} \Biggl[ \biggl( \bnu\bigl[\bbeta-\bone\bigr] \biggr)_{sia} \Biggr]_{si} \Biggr]_{sia} \right)
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{\sigma}} \biggr)_{si} }{ \partial \biggl( \bbeta \biggr)_{s'i'a'} } \;=\; 
	\Biggl[ \biggl( \bm{T_5^J} \biggr)_{sis'i'a'} \biggl( \bsigma \biggr)_{s'i'a'} \Biggr]_{sis'i'a'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{\sigma}} \biggr)_{si} }{ \partial \biggl( \bV \biggr)_{s'i'} } \;=\; \biggl( \bzero \biggr)_{sis'i'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{\sigma}} \biggr)_{si} }{ \partial t } \;=\; \biggl( \bzero \biggr)_{si}
\end{align*}
with $\biggl(\bm{T_0^J}\biggr), \dots, \biggl(\bm{T_5^J}\biggr)$ as above.






\newpage
\section{Harsanyi's Log Game Homotopy}


\subsection*{Homotopy Function}

The homotopy function $H: \R^{n+1} \rightarrow \R^n$ is based on \citet[eqn.~X, p.~Y]{Eibelshaeuseretal2021LogGame}, but parameterized in log strategies $\bbeta = \log(\bsigma)$.
\begin{align*}
	H(\bbeta,\bV,t) \;=\;
	\begin{pmatrix} 
		H^{V}(\bbeta,\bV,\lambda) \\ 
		H^{\sigma}(\bbeta,\bV,\lambda) 
	\end{pmatrix}
\end{align*}
with
\begin{align*}
	& \begin{aligned}
		H^V_{sia}(\bbeta,\bV,t) & \;=\; - V_{si} + t \; \biggl( u_{si}(a,\bbeta_{s,\minusi}) + \delta_i \sum\limits_{\mathclap{s'\in S}} \phiss(a,\bbeta_{s,\minusi}) \; V_{s'i} \biggr) \\
		& \qquad + (1-t) \; \biggl( \nu_{sia} \exp(-\beta_{sia}) + \sum\limits_{\mathclap{a'\in A_{si}}} \nu_{sia'} \bigl[ \beta_{sia'} - 1 \bigr] \biggr)
	\end{aligned} && s\in S, i\in I, a\in A_{si} \\
	& H^\sigma_{si}(\bbeta,\bV,t) \;\; \;=\; \sum\limits_{\mathclap{a\in A_{si}}} \exp(\beta_{sia}) \:-\: 1 && s\in S, i\in I
\end{align*}
where $\bnu$ denotes the individual weights of the logarithmic penalty terms.

Note: Corresponds to tracing homotopy with $\rho \equiv \bzero$ and $\eta \rightarrow \infty$.


\subsection*{Jacobian Matrix}

$J: \R^{n+1} \rightarrow \R^n \times \R^{n+1}$:
\begin{align*}
	J(\bbeta,\bV,t) \;=\; 
		\begin{pmatrix}
			\frac{ \partial H^V_{sia}(\bbeta,\bV,t) }{ \partial\beta_{s'i'a'} } 
				& \frac{ \partial H^V_{sia}(\bbeta,\bV,t) }{ \partial V_{s'i'} } 
				& \frac{ \partial H^V_{sia}(\bbeta,\bV,t) }{ \partial t } \\[1em] 
			\frac{ \partial H^\sigma_{si}(\bbeta,\bV,t) }{ \partial \beta_{s'i'a'} } 
				& \frac{ \partial H^\sigma_{si}(\bbeta,\bV,t) }{ \partial V_{s'i'} } 
				& \frac{ \partial H^\sigma_{si}(\bbeta,\bV,t) }{ \partial t }
		\end{pmatrix} 
\end{align*}
with
\begin{align*}
	\frac{ \partial H^V_{sia}(\bbeta,\bV,t) }{ \partial \beta_{s'i'a'} } \;=\; 
		\begin{cases}
			\begin{aligned}
				& (1-t) \nu_{sia} \bigl[1-\exp(-\beta_{sia})\bigr]
			\end{aligned} & 
			\begin{aligned}
				& \text{if } s'=s, i'=i \\ &\text{and } a'=a
			\end{aligned} \\[1em]
			\begin{aligned}
				& (1-t) \nu_{sia'}
			\end{aligned} & 
			\begin{aligned}
				& \text{if } s'=s, i'=i \\ &\text{and } a'\neq a
			\end{aligned} \\[1em]
			\begin{aligned} 
				& t \, \exp(\beta_{si'a'}) \biggl( u_{si}\bigl(a_{si},a_{si'}',\bbeta_{s,\shortminus\{i,i'\}}\bigr) \\
				& \qquad + \delta_i \sum\limits_{\mathclap{s''\in S}} \phi_{s\shortrightarrow s''}\bigl(a_{si},a_{si'}',\bbeta_{s,\shortminus\{i,i'\}}\bigr) \; V_{s''i} \biggr)
			\end{aligned} & 
			\begin{aligned}
				& \text{if } s'=s \\ &\text{and } i'\neq i  
			\end{aligned} \\[1em]
			0 & \text{else}
		\end{cases}
\end{align*}
\begin{align*}
	\frac{ \partial H^V_{sia}(\bbeta,\bV,t) }{ \partial V_{s'i'} } \;=\;
		\begin{cases}
			t \, \delta_i \phiss(a,\bbeta_{s,\minusi}) - 1 &\text{if } i'=i \text{ and } s'=s \\
			t \, \delta_i \phiss(a,\bbeta_{s,\minusi}) &\text{if } i'=i \text{ and } s'\neq s \\
			0 &\text{if } i'\neq i
		\end{cases}
\end{align*}
\begin{align*}
	\frac{\partial H^V_{sia}(\bbeta,\bV,t) }{ \partial t } & \;=\; 
		u_{si}(a,\bbeta_{s,\minusi}) + \delta_i \sum\limits_{s'\in S} \phiss(a,\bbeta_{s,\minusi}) \; V_{s'i} \\
		& \qquad \;-\; \nu_{sia}\exp(-\beta_{sia}) - \sum\limits_{\mathclap{a'\in A_{si}}} \nu_{sia'} \bigl[ \beta_{sia'} - 1 \bigr]
\end{align*}

\begin{align*}
	\frac{ \partial H^\sigma_{si}(\bbeta,\bV,t) }{ \partial \beta_{s'i'a'}} \;=\; 
		\begin{cases}
			\exp(\beta_{sia'}) \qquad&\text{if } s'=s \text{ and } i'=i \\
			0 \qquad&\text{else}  
		\end{cases}
\end{align*}
\begin{align*}
	\frac{ \partial H^\sigma_{si}(\bbeta,\bV,t) }{ \partial V_{s'i'} } \quad=\quad \frac{ \partial H^\sigma_{si}(\bbeta,\bV,t) }{ \partial t } \quad=\quad 0
\end{align*}




\subsection*{Tensor Notation}


\subsubsection*{Primitives}

\begin{align*}
	\biggl( \bbeta \biggr)_{sia} & \;:=\; \biggl( \beta_{sia} \biggr)_{s\in S, i\in I,a \in A_{si}} \\
	\biggl( \bsigma \biggr)_{sia} & \;:=\; \biggl( \exp(\beta_{sia}) \biggr)_{s\in S, i\in I,a \in A_{si}} \\
	\biggl( \bsigma^{-1} \biggr)_{sia} & \;:=\; \biggl( \exp(-\beta_{sia}) \biggr)_{s\in S, i\in I,a \in A_{si}} \\
	\biggl( \bnu \biggr)_{sia} & \;:=\; \biggl( \nu_{sia} \biggr)_{s\in S, i\in I, a\in A_{si}} \\
	\biggl( \bnu\bigl[\bbeta-\bone\bigr] \biggr)_{sia} & \;:=\; \biggl( \nu_{sia}\bigl[\beta_{sia}-1\bigr] \biggr)_{s\in S, i\in I, a\in A_{si}} \\
	\biggl( \bm{u} \biggr)_{si\ba} & \;:=\; \biggl( u_{si}(\ba) \biggr)_{s\in S, i\in I, \ba\in A} \\
	\biggl( \bV \biggr)_{si} & \;:=\; \biggl( V_{si} \biggr)_{s\in S, i\in I}
\end{align*}
Transition probabilities including individual discount factors:
\begin{align*}
	\biggl( \bm{\phi} \biggr)_{si\ba s'} & \;:=\; \biggl( \delta_i \; \phiss(\ba) \biggr)_{s\in S, i\in I, \ba\in A}
\end{align*}
Discounted payoffs:
\begin{align*}
	\biggl( \bm{{\tu}} \biggr)_{si\ba} & \;:=\; \biggl( \bm{u} \biggr)_{si\ba} \;+\; \left[ \quad \biggl( \bm{\phi} \biggr)_{si\ba s'} \; \biggl( \bV \biggr)_{s'i} \quad \right]_{si\ba}
\end{align*}
Expected discounted payoffs in auxiliary game for player $i$ in state $s$ playing action $a$ while all other players $i'\neq i$ play according to $\bsigma$:
\begin{align*}
	\biggl( \bm{{E\tu^{a}}} \biggr)_{sia} & \;:=\; \left[ \quad \biggl( \bm{{\tu}} \biggr)_{si\ba} \; \prod\limits_{i'\neq i} \biggl( \bsigma \biggr)_{si'a_{i'}} \quad \right]_{sia}
\end{align*}
Expected discounted payoffs for player $i$ in state $s$ when player $i$ plays action $a$ and player $i'$ plays action $a'$ and all other players $i'' \neq i, i'$ play according to $\bsigma$. \\
Note 1: Here, expectation taken w.r.t.\ actual strategies; no beliefs involved. \\
Note 2: The case $i'=i$ is explicitly included to allow for decision problems with $|I|=1$.
\begin{align*}
	\biggl( \bm{{E\tu^{a,a'}}} \biggr)_{sii'aa'} & \;:=\; \left[ \quad \biggl( \bm{{\tu}} \biggr)_{si\ba} \; \prod\limits_{i''\neq i,i'} \biggl( \bsigma \biggr)_{si''a_{i''}} \quad \right]_{sii'aa'}
\end{align*} 


\subsubsection*{Homotopy Function}

\begin{align*}
	\biggl( \bm{H^{V}} \biggr)_{sia} & \;=\; 
		t \; \biggl( \bm{{E\tu^{a}}} \biggr)_{sia} \;-\; \Biggl[ \biggl( \bone \biggr)_{sia} \; \biggl( \bV \biggr)_{si} \Biggr]_{sia} \\
		& \qquad \;+\; (1-t) \; \left( \Biggl[ \biggl( \bnu \biggr)_{sia} \biggl( \bsigma^{-1} \biggr) \Biggr]_{sia} + \Biggl[ \biggl( \bone \biggr)_{sia} \Biggl[ \biggl( \bnu\bigl[\bbeta-\bone\bigr] \biggr)_{sia} \Biggr]_{si} \Biggr]_{sia} \right)
\end{align*}
\begin{align*}
	\biggl( \bm{H^{\sigma}} \biggr)_{si} & \;=\; 
		\Biggl[ \biggl( \bsigma \biggr)_{sia} \Biggr]_{si} \;-\; \biggl( \bone \biggr)_{si} 
\end{align*}


\subsubsection*{Jacobian Matrix} 

\begin{align*}
	\frac{ \partial \biggl( \bm{H^{V}} \biggr)_{sia} }{ \partial \biggl( \bbeta \biggr)_{s'i'a'} } & \;=\; 
		(1-t) \; \left[ \biggl( \bm{T_0^J} \biggr)_{sias'i'a'} \; \Biggl[ \biggl( \bnu \biggr)_{s'i'a'} \Biggl( \biggl( \bone \biggr)_{s'i'a'} - \biggl( \bsigma^{-1} \biggr)_{s'i'a'} \Biggr) \Biggr]_{s'i'a'} \right]_{sias'i'a'} \\
		& \qquad \;+\;  (1-t) \; \Biggl[ \biggl( \bm{T_1^J} \biggr)_{sias'i'a'} \biggl( \bnu \biggr)_{sia'} \Biggr]_{sias'i'a'} \\
		& \qquad \;+\; t \; \Biggl[ \biggl( \bm{T_2^J} \biggr)_{sias'i'a'} \biggl( \bsigma \biggr)_{si'a'} \biggl( \bm{{E\tu^{a,a'}}} \biggr)_{sii'aa'} \Biggr]_{sias'i'a'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{V}} \biggr)_{sia} }{ \partial \biggl( \bV \biggr)_{s'i'} } & \;=\; 
		t \; \Biggl[ \biggl( \bm{T_3^J} \biggr)_{sias'i'} \biggl( \bm{\phi} \biggr)_{sias'} \Biggr]_{sias'i'} - \biggl( \bm{T_4^J} \biggr)_{sias'i'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{V}} \biggr)_{sia} }{ \partial t } & \;=\; 
		\biggl( \bm{{E\tu^{a}}} \biggr)_{sia} - \Biggl[ \biggl( \bnu \biggr)_{sia} \biggl( \bsigma^{-1} \biggr)_{sia} \Biggr]_{sia} - \Biggl[ \biggl( \bone \biggr)_{sia} \Biggl[ \biggl( \bnu\bigl[\bbeta-\bone\bigr] \biggr)_{sia} \Biggr]_{si} \Biggr]_{sia}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{\sigma}} \biggr)_{si} }{ \partial \biggl( \bbeta \biggr)_{s'i'a'} } \;=\; 
	\Biggl[ \biggl( \bm{T_5^J} \biggr)_{sis'i'a'} \biggl( \bsigma \biggr)_{s'i'a'} \Biggr]_{sis'i'a'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{\sigma}} \biggr)_{si} }{ \partial \biggl( \bV \biggr)_{s'i'} } \;=\; \biggl( \bzero \biggr)_{sis'i'}
\end{align*}
\begin{align*}
	\frac{ \partial \biggl( \bm{H^{\sigma}} \biggr)_{si} }{ \partial t } \;=\; \biggl( \bzero \biggr)_{si}
\end{align*}
with
\begin{align*}
	& \biggl( \bm{T_0^J} \biggr)_{sias'i'a'} = \biggl( \id_{\{s'=s,i'=i,a'=a\}} \biggr)_{sias'i'a'} \\
	& \biggl( \bm{T_1^J} \biggr)_{sias'i'a'} = \biggl( \id_{\{s'=s,i'=i,a'\neq a\}} \biggr)_{sias'i'a'} \\
	& \biggl( \bm{T_2^J} \biggr)_{sias'i'a'} = \biggl( \id_{\{s'=s,i'\neq i\}} \biggr)_{sias'i'a'} \\
	& \biggl( \bm{T_3^J} \biggr)_{sias'i'} = \biggl( \id_{\{i'=i\}} \biggr)_{sias'i'} \\
	& \biggl( \bm{T_4^J} \biggr)_{sias'i'} = \biggl( \id_{\{s'=s,i'=i\}} \biggr)_{sias'i'} \\
	& \biggl( \bm{T_5^J} \biggr)_{sis'i'a'} = \biggl( \id_{\{s'=s,i'=i\}} \biggr)_{sis'i'a'}
\end{align*}









\newpage
\section{Interior-Point Homotopy of Herings and PhD Students}

\citep*{Heringsetal2021}.

Note: $t$ goes from $1$ to $0$.

\subsection*{Homotopy Function}

\begin{align*}
	H(\bz,\bV,t) \;=\;
	\begin{pmatrix} 
		H^{V}(\bz,\bV,t) \\ 
		H^{\sigma}(\bz,\bV,t) 
	\end{pmatrix}
\end{align*}
with
\begin{align*}
	& \begin{aligned}
		H^V_{sia}(\bz,\bV,t) & \;=\; (1-t) \Biggl( u_{si}\bigl(a,\bsigma_{s,\minusi}(z_{s,\minusi},t)\bigr) + \delta_i \sum\limits_{\mathclap{s'\in S}} \phiss\bigl(a,\bsigma_{s,\minusi}(z_{s,\minusi},t)\bigr) \; V_{s'i} \Biggr) \\
		& \qquad \;+\; \lambda_{sia}(z_{sia}, t) - V_{si} - t(1-t) \nu_{sia}
	\end{aligned} && s\in S, i\in I, a\in A_{si} \\
	& H^\sigma_{si}(\bz,\bV,t) \;\; \;=\; \sum\limits_{\mathclap{a\in A_{si}}} \sigma(z_{sia},t) \:-\: 1 && s\in S, i\in I
\end{align*}
where
\begin{align*}
	\sigma_{sia}(z_{sia}, t) & \;=\; \frac{1}{4} \Biggl( z_{sia} + \sqrt{z_{sia}^2+4t\sqrt{\sigma^0_{sia}}} \Biggr)^2 \\
	\lambda_{sia}(z_{sia}, t) & \;=\; \frac{1}{4} \Biggl( - z_{sia} + \sqrt{z_{sia}^2+4t\sqrt{\sigma^0_{sia}}} \Biggr)^2
\end{align*}
and $\bsigma^0$ denotes the initial strategy profile and $\bnu$ denotes a perturbation term.


\subsection*{Jacobian Matrix}

$J: \R^{n+1} \rightarrow \R^n \times \R^{n+1}$:
\begin{align*}
	J(\bz,\bV,t) \;=\; 
	\begin{pmatrix}
		\frac{ \partial H^V_{sia}(\bz,\bV,t) }{ \partial z_{s'i'a'} } 
		& \frac{ \partial H^V_{sia}(\bz,\bV,t) }{ \partial V_{s'i'} } 
		& \frac{ \partial H^V_{sia}(\bz,\bV,t) }{ \partial t } \\[1em] 
		\frac{ \partial H^\sigma_{si}(\bz,\bV,t) }{ \partial z_{s'i'a'} } 
		& \frac{ \partial H^\sigma_{si}(\bz,\bV,t) }{ \partial V_{s'i'} } 
		& \frac{ \partial H^\sigma_{si}(\bz,\bV,t) }{ \partial t }
	\end{pmatrix} 
\end{align*}
with
\begin{align*}
	\frac{ \partial H^V_{sia}(\bz,\bV,t) }{ \partial z_{s'i'a'} } \;=\; 
	\begin{cases}
		\begin{aligned}
			& \frac{\partial \lambda_{sia}}{\partial z_{sia}}
		\end{aligned} & 
		\begin{aligned}
			& \text{if } s'=s, i'=i \\ &\text{and } a'=a
		\end{aligned} \\[1em]
		\begin{aligned}
			& (1-t) \frac{\partial \sigma_{si'a'}}{\partial z_{si'a'}} \biggl( u_{si}\bigl(a_{si},a_{si'}',\bsigma_{s,\shortminus\{i,i'\}}\bigr) \\
			& \qquad + \delta_i \sum\limits_{\mathclap{s''\in S}} \phi_{s\shortrightarrow s''}\bigl(a_{si},a_{si'}',\bsigma_{s,\shortminus\{i,i'\}}\bigr) \; V_{s''i} \biggr)
		\end{aligned} & 
		\begin{aligned}
			& \text{if } s'=s \\ &\text{and } i'\neq i 
		\end{aligned} \\[1em]
		0 & \text{else}
	\end{cases}
\end{align*}
\begin{align*}
	\frac{ \partial H^V_{sia}(\bz,\bV,t) }{ \partial V_{s'i'} } \;=\;
	\begin{cases}
		(1-t) \delta_i \phiss(a,\bsigma_{s,\minusi}) - 1 &\text{if } i'=i \text{ and } s'=s \\
		(1-t) \delta_i \phiss(a,\bsigma_{s,\minusi}) &\text{if } i'=i \text{ and } s'\neq s \\
		0 &\text{if } i'\neq i
	\end{cases}
\end{align*}
\begin{align*}
	\frac{\partial H^V_{sia}(\bz,\bV,t) }{ \partial t } & \;=\; 
	\sum\limits_{\substack{i'\in I \\ i'\neq i}} \sum\limits_{a_{si'}'\in A_{si'}} (1-t) \frac{\partial\sigma_{si'a'}}{\partial t} \Biggl( u_{si}\bigl(a_{si},a_{si'}',\bsigma_{s,\shortminus\{i,i'\}}\bigr) + \delta_i \sum\limits_{\mathclap{s''\in S}} \phi_{s\shortrightarrow s''}\bigl(a_{si},a_{si'}',\bsigma_{s,\shortminus\{i,i'\}}\bigr) \; V_{s''i} \Biggr) \\
	& \qquad \;+\; \frac{\partial\lambda_{sia}}{\partial t} \;-\; (1-2t) \nu_{sia} \\
	& 
\end{align*}

\begin{align*}
	\frac{ \partial H^\sigma_{si}(\bz,\bV,t) }{ \partial z_{s'i'a'}} \;=\; 
	\begin{cases}
		\frac{\partial\sigma_{sia}}{\partial z_{s'i'a'} } \qquad&\text{if } s'=s \text{ and } i'=i \\
		0 \qquad&\text{else}  
	\end{cases}
\end{align*}
\begin{align*}
	\frac{ \partial H^\sigma_{si}(\bz,\bV,t) }{ \partial V_{s'i'} } \quad=\quad 0
\end{align*}
\begin{align*}
	\frac{ \partial H^\sigma_{si}(\bz,\bV,t) }{ \partial t } \quad=\quad \sum\limits_{a\in A_{si}} \frac{\partial\sigma_{sia}}{\partial t}
\end{align*}

where
\begin{align*}
	\frac{\partial\sigma_{sia}}{\partial z_{sia}} \quad=\quad \frac{3}{2} z_{sia} \;+\; \frac{1}{2} \sqrt{z_{sia}^2+4t\sqrt{\sigma^0_{sia}}} \;+\; \frac{z_{sia}^2}{\sqrt{z_{sia}^2+4t\sqrt{\sigma^0_{sia}}}}
\end{align*}
\begin{align*}
	\frac{\partial\sigma_{sia}}{\partial t} \quad=\quad 2\sqrt{\sigma^0_{sia}} \;+\; \frac{2z_{sia}\sqrt{\sigma^0_{sia}}}{\sqrt{z_{sia}^2+4t\sqrt{\sigma^0_{sia}}}}
\end{align*}

and
\begin{align*}
	\frac{\partial\lambda_{sia}}{\partial z_{sia}} \quad=\quad \frac{3}{2} z_{sia} \;-\; \frac{1}{2} \sqrt{z_{sia}^2+4t\sqrt{\sigma^0_{sia}}} \;-\; \frac{z_{sia}^2}{\sqrt{z_{sia}^2+4t\sqrt{\sigma^0_{sia}}}}
\end{align*}
\begin{align*}
	\frac{\partial\lambda_{sia}}{\partial t} \quad=\quad 2\sqrt{\sigma^0_{sia}} \;-\; \frac{2z_{sia}\sqrt{\sigma^0_{sia}}}{\sqrt{z_{sia}^2+4t\sqrt{\sigma^0_{sia}}}}
\end{align*}






\newpage
\bibliography{literature}


\end{document}
